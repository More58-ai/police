<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Національна поліція України</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --gold: #ffd700; --blue: #0066ff; --bg: #050505; --white: #ffffff; --online: #00ff88; }
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body, html { width: 100%; height: 100%; font-family: 'Montserrat', sans-serif; background-color: var(--bg); color: white; overflow-x: hidden; }

        /* ЕФЕКТИ ТА ФОН */
        #snow-canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 1002; }
        .background-scene { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-image: url('https://i.postimg.cc/V6dqQJmL/Gemini-Generated-Image-1jznmn1jznmn1jzn.png'); background-size: cover; background-position: center; z-index: -2; filter: brightness(0.12) blur(5px); }
        .gradient-mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, transparent 0%, rgba(5,5,5,0.9) 100%); z-index: -1; }

        /* HEADER */
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 5%; position: fixed; width: 100%; top: 0; z-index: 1000; background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); border-bottom: 1px solid rgba(255,215,0,0.3); }
        .logo-container { display: flex; align-items: center; gap: 12px; }
        .header-logo { height: 50px; }
        
        /* ОНЛАЙН В КУТКУ */
        .online-box { position: fixed; bottom: 20px; left: 20px; z-index: 1001; background: rgba(0,0,0,0.7); padding: 5px 15px; border-radius: 50px; border: 1px solid var(--online); font-size: 10px; font-weight: 900; color: var(--online); letter-spacing: 1px; }

        /* HERO SECTION */
        .hero { min-height: 100vh; padding: 120px 5% 50px; display: flex; align-items: center; position: relative; }
        .hero-content { z-index: 10; max-width: 800px; }
        .hero-img { position: absolute; right: 2%; bottom: 0; height: 85vh; z-index: 1; pointer-events: none; }
        .hero h1 { font-size: clamp(30px, 6vw, 70px); font-weight: 900; line-height: 1; text-transform: uppercase; margin-bottom: 20px; }
        
        /* КНОПКИ ПІДРОЗДІЛІВ */
        .unit-nav { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 30px; max-width: 400px; }

        /* SIDEBAR */
        .sidebar { position: fixed; top: 0; right: -100%; width: 100%; max-width: 450px; height: 100%; background: rgba(5,5,5,0.98); z-index: 3000; transition: 0.5s cubic-bezier(0.77, 0, 0.175, 1); padding: 80px 40px; border-left: 2px solid var(--gold); overflow-y: auto; }
        .sidebar.active { right: 0; }
        .side-logo { width: 180px; display: block; margin: 0 auto 30px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); filter: drop-shadow(0 0 5px var(--blue)); } 50% { transform: translateY(-15px); filter: drop-shadow(0 0 20px var(--blue)); } }
        .side-text { font-size: 15px; line-height: 1.8; opacity: 0.8; margin-bottom: 40px; text-align: justify; }

        /* РЕЄСТР */
        .staff-page { position: fixed; inset: 0; background: radial-gradient(circle at top, #111, #050505); z-index: 4000; display: none; padding: 100px 5% 50px; overflow-y: auto; }
        .staff-container { max-width: 1200px; margin: 0 auto; }
        .staff-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; margin-top: 30px; }
        
        .staff-card { 
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 100%);
            border: 1px solid rgba(255,215,0,0.1);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: 0.4s;
            position: relative;
            overflow: hidden;
        }
        .staff-card::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,215,0,0.05), transparent);
            transition: 0.5s;
        }
        .staff-card:hover { transform: translateY(-5px); border-color: var(--gold); background: rgba(255,215,0,0.03); }
        .staff-card:hover::before { left: 100%; }

        .staff-ava { width: 70px; height: 70px; border-radius: 15px; object-fit: cover; border: 2px solid rgba(255,215,0,0.2); background: #111; }
        .staff-info b { font-size: 18px; display: block; letter-spacing: 1px; margin-bottom: 5px; color: var(--white); }
        
        /* АДМІН ПАНЕЛЬ */
        .admin-controls { 
            background: rgba(255,215,0,0.03); 
            border: 1px dashed var(--gold); 
            padding: 25px; 
            border-radius: 20px; 
            margin-top: 50px; 
            display: none;
        }

        .btn-gold { border: 2px solid var(--gold); color: var(--gold); padding: 12px 25px; background: transparent; cursor: pointer; font-weight: 900; text-transform: uppercase; border-radius: 4px; transition: 0.3s; font-size: 11px; }
        .btn-gold:hover { background: var(--gold); color: black; box-shadow: 0 0 20px var(--gold); }
        
        .role-tag { font-size: 10px; padding: 5px 12px; border-radius: 6px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; display: inline-block; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .role-admin { background: linear-gradient(90deg, #f00, #ff0, #f00); background-size: 200%; animation: rb 3s linear infinite; color: #fff; text-shadow: 0 0 5px #000; }
        @keyframes rb { 0%{background-position:0%} 100%{background-position:200%} }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: #0a0a0a; border: 2px solid var(--gold); padding: 40px; border-radius: 20px; text-align: center; width: 100%; max-width: 400px; }
        .leader-img { width: 180px; height: 180px; border-radius: 20px; object-fit: cover; border: 2px solid var(--gold); margin-bottom: 20px; }
    </style>
</head>
<body onclick="playMusic()">

    <audio id="bg-music" loop><source src="https://raw.githubusercontent.com/More58-ai/NPU/main/Wham!%20-%20Last%20Christmas%20(Official%20Video).mp3" type="audio/mpeg"></audio>
    <canvas id="snow-canvas"></canvas>
    <div class="background-scene"></div>
    <div class="gradient-mask"></div>

    <div class="online-box">ONLINE: <span id="online-count">0</span></div>

    <header>
        <div class="logo-container">
            <img src="https://i.postimg.cc/KcBqpWz7/npu-removebg-preview.png" class="header-logo">
            <b style="letter-spacing:1px; font-size: 14px;">НАЦІОНАЛЬНА ПОЛІЦІЯ УКРАЇНИ</b>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="btn-gold" style="padding:8px 15px;" onclick="openPage('page-staff')">РЕЄСТР</button>
            <button class="btn-gold" style="padding:8px 15px;" onclick="toggleModal('modal-account', true)">ПРОФІЛЬ</button>
        </div>
    </header>

    <main class="hero">
        <img src="https://i.postimg.cc/QtKW3skc/snapedit-1768682778382-removebg-preview.png" class="hero-img">
        <div class="hero-content">
            <h1>СЛУЖИТИ ТА<br><span style="color:var(--gold)">ЗАХИЩАТИ</span></h1>
            <p style="opacity:0.7; max-width: 500px; line-height:1.6;">Офіційний інформаційний портал Національної поліції України. Моніторинг особового складу, архів подій та доступ до підрозділів.</p>
            
            <div class="unit-nav">
                <button class="btn-gold" onclick="openSidebar('pp')">Патрульна</button>
                <button class="btn-gold" onclick="openSidebar('kord')">КОРД</button>
                <button class="btn-gold" onclick="openSidebar('gsu')">ГСУ</button>
                <button class="btn-gold" onclick="openPage('page-gallery')">Галерея</button>
            </div>
        </div>
    </main>

    <div id="side-panel" class="sidebar">
        <button onclick="closeSidebar()" style="position:absolute; top:30px; left:30px; background:none; border:none; color:var(--gold); font-size:30px; cursor:pointer;">&times;</button>
        <img id="side-img" src="" class="side-logo">
        <h2 id="side-title" style="text-align:center; color:var(--gold); margin-bottom:20px; font-weight:900;"></h2>
        <p id="side-desc" class="side-text"></p>
        <button class="btn-gold" style="width:100%" id="side-btn-leader">Керівник підрозділу</button>
    </div>

    <div id="page-staff" class="staff-page">
        <div class="staff-container">
            <h1 style="text-align:center; margin-bottom:10px; font-weight:900; font-size:40px; color:var(--gold);">ОСОБОВИЙ СКЛАД</h1>
            <p style="text-align:center; opacity:0.5; letter-spacing:3px; margin-bottom:40px;">NATIONAL POLICE REGISTER</p>
            
            <div id="staff-list" class="staff-grid"></div>

            <div id="admin-panel" class="admin-controls">
                <h3 style="color:var(--gold); margin-bottom:20px; letter-spacing:1px;"><i class="fa-solid fa-user-gear"></i> КЕРУВАННЯ ПЕРСОНАЛОМ</h3>
                <div id="admin-user-list"></div>
            </div>
            <button class="btn-gold" style="margin:60px auto; display:block; padding: 15px 50px;" onclick="document.getElementById('page-staff').style.display='none'">ПОВЕРНУТИСЬ НА ГОЛОВНУ</button>
        </div>
    </div>

    <div id="page-gallery" style="position:fixed; inset:0; background:#050505; z-index:4000; display:none; padding:100px 5% 50px; overflow-y:auto;">
        <h1 style="text-align:center; margin-bottom:40px;">ГАЛЕРЕЯ</h1>
        <div id="gal-add" style="display:none; text-align:center; margin-bottom:20px;">
            <input id="gal-url" placeholder="URL фото" style="padding:10px; background:#111; color:white; border:1px solid #333;">
            <button class="btn-gold" onclick="addP()">ДОДАТИ</button>
        </div>
        <div id="gallery-list" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 1fr)); gap:15px;"></div>
        <button class="btn-gold" style="margin:40px auto; display:block;" onclick="document.getElementById('page-gallery').style.display='none'">НАЗАД</button>
    </div>

    <div id="modal-account" class="modal">
        <div class="modal-content">
            <div style="position:relative; display:inline-block">
                <img id="my-ava" src="" class="leader-img" style="border-radius:50%; width:120px; height:120px;">
                <label for="f" style="position:absolute; bottom:20px; right:0; background:var(--gold); width:30px; height:30px; border-radius:50%; color:black; display:flex; align-items:center; justify-content:center; cursor:pointer;"><i class="fa-solid fa-camera"></i></label>
                <input type="file" id="f" style="display:none" onchange="up(this)">
            </div>
            <h2 id="my-nick" style="margin:10px 0;">...</h2>
            <div id="my-role"></div>
            <button class="btn-gold" style="width:100%; margin-top:20px; border-color:red; color:red;" onclick="logout()">Вихід</button>
            <p onclick="toggleModal('modal-account', false)" style="margin-top:15px; cursor:pointer; opacity:0.5;">Закрити</p>
        </div>
    </div>

    <div id="modal-leader" class="modal" onclick="this.style.display='none'">
        <div class="modal-content" onclick="event.stopPropagation()">
            <img id="l-img" src="" class="leader-img">
            <h2 id="l-name" style="color:var(--gold);">...</h2>
            <p id="l-rank" style="opacity:0.5; font-size:12px; margin-top:10px;"></p>
            <button class="btn-gold" style="margin-top:25px;" onclick="document.getElementById('modal-leader').style.display='none'">ЗАКРИТИ</button>
        </div>
    </div>

    <div id="viewer" class="modal" onclick="this.style.display='none'"><img id="v-img" style="max-width:95%; max-height:90vh; border:1px solid var(--gold);"></div>

    <div id="auth-screen" style="position:fixed; inset:0; background:#050505; z-index:9999; display:flex; align-items:center; justify-content:center;">
        <div class="modal-content">
            <img src="https://i.postimg.cc/KcBqpWz7/npu-removebg-preview.png" style="height:60px; margin-bottom:20px;">
            <input id="ln" placeholder="Позивний" style="width:100%; padding:12px; margin-bottom:10px; background:#111; border:1px solid #333; color:white;">
            <input id="lp" type="password" placeholder="Пароль" style="width:100%; padding:12px; margin-bottom:20px; background:#111; border:1px solid #333; color:white;">
            <button class="btn-gold" style="width:100%" onclick="login()">УВІЙТИ</button>
            <p style="margin-top:15px; font-size:10px; opacity:0.4; cursor:pointer;" onclick="reg()">Зареєструватись</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, get, update, push } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

        const config = { databaseURL: "https://npuofukraine-default-rtdb.firebaseio.com/" };
        const app = initializeApp(config);
        const db = getDatabase(app);
        const curID = localStorage.getItem('npu_user');

        const UNIT_DATA = {
            pp: { title: "Патрульна Поліція", img: "https://i.postimg.cc/KcBqpWz7/npu-removebg-preview.png", desc: "Департамент патрульної поліції — це міжрегіональний територіальний орган Національної поліції України." },
            kord: { title: "СОР КОРД", img: "https://i.postimg.cc/vZmnJ1QV/kord-removebg-preview.png", desc: "Корпус оперативно-раптової дії (КОРД) — елітний підрозділ поліції особливого призначення." },
            gsu: { title: "ГСУ Поліції", img: "https://i.postimg.cc/KcBqpWz7/npu-removebg-preview.png", desc: "Головне слідче управління забезпечує розслідування кримінальних правопорушень." }
        };

        const ROLES = { admin: {l:"Адміністратор", c:"role-admin"}, gen: {l:"Генерал", c:""}, worker: {l:"Офіцер", c:""}, citizen: {l:"Громадянин", c:""} };

        // Глобальні функції для керування (щоб працювали onchange в HTML)
        window.updateGlow = (id, color) => update(ref(db, 'staff/' + id), { roleGlow: color });
        window.updateRole = (id, role) => update(ref(db, 'staff/' + id), { role: role });

        if(curID) {
            onValue(ref(db, 'staff/'+curID), s => {
                const u = s.val(); if(!u) return;
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('my-nick').innerText = u.nickname;
                document.getElementById('my-ava').src = u.avatar || "https://i.postimg.cc/KcBqpWz7/npu-removebg-preview.png";
                document.getElementById('my-role').innerHTML = `<span class="role-tag ${ROLES[u.role].c}" style="background-color:${u.roleGlow}">${ROLES[u.role].l}</span>`;
                if(u.role === 'admin') { 
                    document.getElementById('admin-panel').style.display='block'; 
                    document.getElementById('gal-add').style.display='block'; 
                }
            });
        }

        window.login = async () => {
            const n = document.getElementById('ln').value.trim();
            const p = document.getElementById('lp').value.trim();
            const s = await get(ref(db, 'staff/'+n));
            if(s.exists() && s.val().password === p) { localStorage.setItem('npu_user', n); location.reload(); }
        };

        window.reg = async () => {
            const n = document.getElementById('ln').value.trim();
            const p = document.getElementById('lp').value.trim();
            if(n && p) {
                await set(ref(db, 'staff/'+n), { nickname: n, password: p, role: 'citizen', avatar: "", roleGlow: 'transparent' });
                localStorage.setItem('npu_user', n); location.reload();
            }
        };

        onValue(ref(db, 'staff'), s => {
            const all = s.val() || {};
            const list = document.getElementById('staff-list');
            const adm = document.getElementById('admin-user-list');
            list.innerHTML = ""; adm.innerHTML = "";
            Object.entries(all).forEach(([id, u]) => {
                list.innerHTML += `
                <div class="staff-card">
                    <img src="${u.avatar || 'https://i.postimg.cc/KcBqpWz7/npu-removebg-preview.png'}" class="staff-ava">
                    <div class="staff-info">
                        <b>${u.nickname}</b>
                        <span class="role-tag ${ROLES[u.role].c}" style="background:${u.roleGlow}">${ROLES[u.role].l}</span>
                    </div>
                </div>`;
                
                // Перевірка на адміна для відображення панелі керування
                get(ref(db, 'staff/'+curID)).then(snapshot => {
                    const viewer = snapshot.val();
                    if(viewer && viewer.role === 'admin' && id !== curID) {
                        const existingEntry = document.getElementById('adm-'+id);
                        if(!existingEntry) {
                            adm.innerHTML += `<div id="adm-${id}" style="margin-bottom:15px; display:flex; align-items:center; gap:10px; background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                                <span style="flex:1">${u.nickname}</span>
                                <input type="color" value="${u.roleGlow || '#ffd700'}" onchange="window.updateGlow('${id}', this.value)">
                                <select style="background:#000; color:#fff; border:1px solid #444; padding:5px;" onchange="window.updateRole('${id}', this.value)">
                                    <option value="citizen" ${u.role==='citizen'?'selected':''}>Громадянин</option>
                                    <option value="worker" ${u.role==='worker'?'selected':''}>Офіцер</option>
                                    <option value="gen" ${u.role==='gen'?'selected':''}>Генерал</option>
                                    <option value="admin" ${u.role==='admin'?'selected':''}>Адмін</option>
                                </select>
                            </div>`;
                        }
                    }
                });
            });
            document.getElementById('online-count').innerText = Object.keys(all).length;
        });

        onValue(ref(db, 'gallery'), s => {
            const g = document.getElementById('gallery-list'); g.innerHTML = "";
            Object.values(s.val()||{}).forEach(i => g.innerHTML += `<img src="${i.url}" onclick="v('${i.url}')" style="width:100%; height:150px; object-fit:cover; border-radius:10px; cursor:pointer; border:1px solid #222;">`);
        });

        window.openSidebar = (type) => {
            const data = UNIT_DATA[type];
            document.getElementById('side-img').src = data.img;
            document.getElementById('side-title').innerText = data.title;
            document.getElementById('side-desc').innerText = data.desc;
            document.getElementById('side-btn-leader').onclick = () => showLeader(type);
            document.getElementById('side-panel').classList.add('active');
        };

        window.showLeader = async (t) => {
            const s = await get(ref(db, 'staff'));
            const u = Object.values(s.val()||{}).find(x => x.role === (t==='pp'?'gen':'admin'));
            document.getElementById('l-img').src = u ? u.avatar : "https://i.postimg.cc/KcBqpWz7/npu-removebg-preview.png";
            document.getElementById('l-name').innerText = u ? u.nickname : "ВАКАНТНО";
            document.getElementById('l-rank').innerText = "КЕРІВНИК ПІДРОЗДІЛУ";
            document.getElementById('modal-leader').style.display='flex';
        };

        window.closeSidebar = () => document.getElementById('side-panel').classList.remove('active');
        window.v = (u) => { document.getElementById('v-img').src = u; document.getElementById('viewer').style.display='flex'; };
        window.up = (i) => { if(i.files[0]){ const r = new FileReader(); r.onload=(e)=>update(ref(db,'staff/'+curID),{avatar:e.target.result}); r.readAsDataURL(i.files[0]); }};
        window.addP = () => { const u = document.getElementById('gal-url').value; if(u) push(ref(db, 'gallery'), {url: u}); };
        window.openPage = (id) => document.getElementById(id).style.display = 'block';
        window.toggleModal = (id, s) => document.getElementById(id).style.display = s ? 'flex' : 'none';
        window.logout = () => { localStorage.clear(); location.reload(); };

        // СНІГ
        const cvs=document.getElementById('snow-canvas'); const ctx=cvs.getContext('2d'); let fs=[];
        function res(){ cvs.width=window.innerWidth; cvs.height=window.innerHeight; fs=[]; for(let i=0;i<100;i++) fs.push({x:Math.random()*cvs.width, y:Math.random()*cvs.height, r:Math.random()*2+1, s:Math.random()*2+2}); }
        function drw(){ ctx.clearRect(0,0,cvs.width,cvs.height); ctx.fillStyle="white"; ctx.beginPath(); fs.forEach(f=>{ ctx.moveTo(f.x,f.y); ctx.arc(f.x,f.y,f.r,0,Math.PI*2); f.y+=f.s; if(f.y>cvs.height)f.y=-5; }); ctx.fill(); requestAnimationFrame(drw); }
        res(); drw(); window.onresize=res;

        let aOn=false; window.playMusic=()=>{ if(!aOn){ let m=document.getElementById('bg-music'); m.volume=0.1; m.play().catch(()=>{}); aOn=true; } };
    </script>
</body>
</html>
